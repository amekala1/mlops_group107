# Use the official Python image from Docker Hub
FROM python:3.9-slim

# Set the working directory
WORKDIR /app

# Accept Kaggle credentials as build arguments
ARG KAGGLE_USERNAME
ARG KAGGLE_KEY

# Set Kaggle credentials as environment variables
ENV KAGGLE_USERNAME=${KAGGLE_USERNAME}
ENV KAGGLE_KEY=${KAGGLE_KEY}

# Create Kaggle config directory and kaggle.json file
RUN mkdir -p /root/.config/kaggle && \
    echo "{\"username\":\"${KAGGLE_USERNAME}\",\"key\":\"${KAGGLE_KEY}\"}" > /root/.config/kaggle/kaggle.json && \
    chmod 600 /root/.config/kaggle/kaggle.json

# Copy application code
COPY . /app

# Install Python dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Expose port
EXPOSE 5000

# Start Flask app
CMD ["python", "app.py"]
